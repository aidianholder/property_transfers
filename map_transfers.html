<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8">
<title>Yakima County Property Transfers</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.js"></script>
<link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.css" rel="stylesheet">
<style>
        body { margin:0; padding:0; }
        #map {width:100%; height: 640px; }


</style>
</head>
<body>


<div id="map"></div>


<script>

let map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'https://aidianholder.com/mapserver/osm-liberty-buildings.json',
    center: [-120.4, 46.5], // starting position [lng, lat]
    zoom: 10 // starting zoom
});

map.on('load', function(){
   map.addLayer({
      'id': 'properties',
      'type': 'circle',
      'source': {
         'type': 'geojson',
         'data': 'transfers.geojson'
      },
      'layout': {},
      'paint': {
         'circle-color': '#ff0000',
         'circle-radius': {
            'base': 2,
            'stops': [[9,2], [10,3], [11,5]]
         }
      }
   })

   let popup = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
      });

      map.on('mouseenter', 'properties', function(e) {
      // Change the cursor style as a UI indicator.
         map.getCanvas().style.cursor = 'pointer';

         let coordinates = e.features[0].geometry.coordinates.slice();
         console.log(e.features[0])

         while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
         coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
         }


         let popupContent = "Address: " + e.features[0].properties['Address'] + " " + e.features[0].properties['City'] + "<br/>Buyer: " +
                    e.features[0].properties['Buyer'] + "<br/>Seller: " + e.features[0].properties['Seller'] + "<br/>Price: $" + e.features[0].properties['Price']


         // Populate the popup and set its coordinates
         // based on the feature found.
         popup.setLngLat(coordinates)
            .setHTML(popupContent)
            .addTo(map);
      });

      map.on('mouseleave', 'places', function() {
      map.getCanvas().style.cursor = '';
      popup.remove();
      });

});

</script>

</body>
</html>

